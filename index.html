<!DOCTYPE html>
<html>

<head>
  <title>Getting Clients IP</title>
  <style>
    p, h1 {
      color: black;
    }
  </style>




</head>

<body>



  <center>
  <h1>My Responsive Javascript On HTML Page</h1>
  <h3>Public IP Address of user is:</h3>

  <p id="user-ip-address"></p>



  <div id="todaysDate"></div>



  <form action='#' method='post'>

    <body style="text-align:center;" id="body">
    <h1 style="color:green;">

    </h1>

    </p>
    <input type="text" id="input1" name="input 1" required><br></br>
    <button onclick="gfg_Run()">
      check
    </button>
    <p id="GFG_DOWN" style="color:green;
							font-size: 20px;">
    </p>
    <script>
      var Input = document.getElementById("input1").value;
      var el_up =
        document.getElementById("GFG_UP");
      var el_down =
        document.getElementById("GFG_DOWN");

      var string =
        '{ "prop_1": "val_1", "prop_2": "val_2" }';
      el_up.innerHTML = input1;

      function testJSON(text) {
        if (typeof text !== "string") {
          return false;
        }
        try {
          JSON.parse(text);
          return true;
        } catch (error) {
          return false;
        }
      }

      function gfg_Run() {
        el_down.innerHTML = testJSON(string);
      }
    </script>
    <h4>Get MD5 version of the text</h4>

    </body>  </form>
    Enter a text:<br/>
    <input type='text' name='strex' id='strex' size='20' /> <input type='button' id='codemd5' value='Get MD5' /><br>
    MD5 hash string:<br>
    <input type='text' name='strmd5' id='strmd5' size='33' />
  </form>

  <script>
    //calculate md5() code of a given input
    function md5(string){function RotateLeft(lValue,iShiftBits){return(lValue<<iShiftBits)|(lValue>>>(32-iShiftBits));}
      function AddUnsigned(lX,lY){var lX4,lY4,lX8,lY8,lResult;lX8=(lX&0x80000000);lY8=(lY&0x80000000);lX4=(lX&0x40000000);lY4=(lY&0x40000000);lResult=(lX&0x3FFFFFFF)+(lY&0x3FFFFFFF);if(lX4&lY4){return(lResult^0x80000000^lX8^lY8);}
        if(lX4|lY4){if(lResult&0x40000000){return(lResult^0xC0000000^lX8^lY8);}else{return(lResult^0x40000000^lX8^lY8);}}else{return(lResult^lX8^lY8);}}
      function F(x,y,z){return(x&y)|((~x)&z);}
      function G(x,y,z){return(x&z)|(y&(~z));}
      function H(x,y,z){return(x^y^z);}
      function I(x,y,z){return(y^(x|(~z)));}
      function FF(a,b,c,d,x,s,ac){a=AddUnsigned(a,AddUnsigned(AddUnsigned(F(b,c,d),x),ac));return AddUnsigned(RotateLeft(a,s),b);};function GG(a,b,c,d,x,s,ac){a=AddUnsigned(a,AddUnsigned(AddUnsigned(G(b,c,d),x),ac));return AddUnsigned(RotateLeft(a,s),b);};function HH(a,b,c,d,x,s,ac){a=AddUnsigned(a,AddUnsigned(AddUnsigned(H(b,c,d),x),ac));return AddUnsigned(RotateLeft(a,s),b);};function II(a,b,c,d,x,s,ac){a=AddUnsigned(a,AddUnsigned(AddUnsigned(I(b,c,d),x),ac));return AddUnsigned(RotateLeft(a,s),b);};function ConvertToWordArray(string){var lWordCount;var lMessageLength=string.length;var lNumberOfWords_temp1=lMessageLength+8;var lNumberOfWords_temp2=(lNumberOfWords_temp1-(lNumberOfWords_temp1 % 64))/64;var lNumberOfWords=(lNumberOfWords_temp2+1)*16;var lWordArray=Array(lNumberOfWords-1);var lBytePosition=0;var lByteCount=0;while(lByteCount<lMessageLength){lWordCount=(lByteCount-(lByteCount % 4))/4;lBytePosition=(lByteCount % 4)*8;lWordArray[lWordCount]=(lWordArray[lWordCount]|(string.charCodeAt(lByteCount)<<lBytePosition));lByteCount++;}
        lWordCount=(lByteCount-(lByteCount % 4))/4;lBytePosition=(lByteCount % 4)*8;lWordArray[lWordCount]=lWordArray[lWordCount]|(0x80<<lBytePosition);lWordArray[lNumberOfWords-2]=lMessageLength<<3;lWordArray[lNumberOfWords-1]=lMessageLength>>>29;return lWordArray;};function WordToHex(lValue){var WordToHexValue='',WordToHexValue_temp='',lByte,lCount;for(lCount=0;lCount<=3;lCount++){lByte=(lValue>>>(lCount*8))&255;WordToHexValue_temp='0'+lByte.toString(16);WordToHexValue=WordToHexValue+WordToHexValue_temp.substr(WordToHexValue_temp.length-2,2);}
        return WordToHexValue;};function Utf8Encode(string){string=string.replace(/\r\n/g,'\n');var utftext='';for(var n=0;n<string.length;n++){var c=string.charCodeAt(n);if(c<128){utftext+=String.fromCharCode(c);}
      else if((c>127)&&(c<2048)){utftext+=String.fromCharCode((c>>6)|192);utftext+=String.fromCharCode((c&63)|128);}
      else{utftext+=String.fromCharCode((c>>12)|224);utftext+=String.fromCharCode(((c>>6)&63)|128);utftext+=String.fromCharCode((c&63)|128);}}
        return utftext;};var x=Array();var k,AA,BB,CC,DD,a,b,c,d;var S11=7,S12=12,S13=17,S14=22;var S21=5,S22=9,S23=14,S24=20;var S31=4,S32=11,S33=16,S34=23;var S41=6,S42=10,S43=15,S44=21;string=Utf8Encode(string);x=ConvertToWordArray(string);a=0x67452301;b=0xEFCDAB89;c=0x98BADCFE;d=0x10325476;for(k=0;k<x.length;k+=16){AA=a;BB=b;CC=c;DD=d;a=FF(a,b,c,d,x[k+0],S11,0xD76AA478);d=FF(d,a,b,c,x[k+1],S12,0xE8C7B756);c=FF(c,d,a,b,x[k+2],S13,0x242070DB);b=FF(b,c,d,a,x[k+3],S14,0xC1BDCEEE);a=FF(a,b,c,d,x[k+4],S11,0xF57C0FAF);d=FF(d,a,b,c,x[k+5],S12,0x4787C62A);c=FF(c,d,a,b,x[k+6],S13,0xA8304613);b=FF(b,c,d,a,x[k+7],S14,0xFD469501);a=FF(a,b,c,d,x[k+8],S11,0x698098D8);d=FF(d,a,b,c,x[k+9],S12,0x8B44F7AF);c=FF(c,d,a,b,x[k+10],S13,0xFFFF5BB1);b=FF(b,c,d,a,x[k+11],S14,0x895CD7BE);a=FF(a,b,c,d,x[k+12],S11,0x6B901122);d=FF(d,a,b,c,x[k+13],S12,0xFD987193);c=FF(c,d,a,b,x[k+14],S13,0xA679438E);b=FF(b,c,d,a,x[k+15],S14,0x49B40821);a=GG(a,b,c,d,x[k+1],S21,0xF61E2562);d=GG(d,a,b,c,x[k+6],S22,0xC040B340);c=GG(c,d,a,b,x[k+11],S23,0x265E5A51);b=GG(b,c,d,a,x[k+0],S24,0xE9B6C7AA);a=GG(a,b,c,d,x[k+5],S21,0xD62F105D);d=GG(d,a,b,c,x[k+10],S22,0x2441453);c=GG(c,d,a,b,x[k+15],S23,0xD8A1E681);b=GG(b,c,d,a,x[k+4],S24,0xE7D3FBC8);a=GG(a,b,c,d,x[k+9],S21,0x21E1CDE6);d=GG(d,a,b,c,x[k+14],S22,0xC33707D6);c=GG(c,d,a,b,x[k+3],S23,0xF4D50D87);b=GG(b,c,d,a,x[k+8],S24,0x455A14ED);a=GG(a,b,c,d,x[k+13],S21,0xA9E3E905);d=GG(d,a,b,c,x[k+2],S22,0xFCEFA3F8);c=GG(c,d,a,b,x[k+7],S23,0x676F02D9);b=GG(b,c,d,a,x[k+12],S24,0x8D2A4C8A);a=HH(a,b,c,d,x[k+5],S31,0xFFFA3942);d=HH(d,a,b,c,x[k+8],S32,0x8771F681);c=HH(c,d,a,b,x[k+11],S33,0x6D9D6122);b=HH(b,c,d,a,x[k+14],S34,0xFDE5380C);a=HH(a,b,c,d,x[k+1],S31,0xA4BEEA44);d=HH(d,a,b,c,x[k+4],S32,0x4BDECFA9);c=HH(c,d,a,b,x[k+7],S33,0xF6BB4B60);b=HH(b,c,d,a,x[k+10],S34,0xBEBFBC70);a=HH(a,b,c,d,x[k+13],S31,0x289B7EC6);d=HH(d,a,b,c,x[k+0],S32,0xEAA127FA);c=HH(c,d,a,b,x[k+3],S33,0xD4EF3085);b=HH(b,c,d,a,x[k+6],S34,0x4881D05);a=HH(a,b,c,d,x[k+9],S31,0xD9D4D039);d=HH(d,a,b,c,x[k+12],S32,0xE6DB99E5);c=HH(c,d,a,b,x[k+15],S33,0x1FA27CF8);b=HH(b,c,d,a,x[k+2],S34,0xC4AC5665);a=II(a,b,c,d,x[k+0],S41,0xF4292244);d=II(d,a,b,c,x[k+7],S42,0x432AFF97);c=II(c,d,a,b,x[k+14],S43,0xAB9423A7);b=II(b,c,d,a,x[k+5],S44,0xFC93A039);a=II(a,b,c,d,x[k+12],S41,0x655B59C3);d=II(d,a,b,c,x[k+3],S42,0x8F0CCC92);c=II(c,d,a,b,x[k+10],S43,0xFFEFF47D);b=II(b,c,d,a,x[k+1],S44,0x85845DD1);a=II(a,b,c,d,x[k+8],S41,0x6FA87E4F);d=II(d,a,b,c,x[k+15],S42,0xFE2CE6E0);c=II(c,d,a,b,x[k+6],S43,0xA3014314);b=II(b,c,d,a,x[k+13],S44,0x4E0811A1);a=II(a,b,c,d,x[k+4],S41,0xF7537E82);d=II(d,a,b,c,x[k+11],S42,0xBD3AF235);c=II(c,d,a,b,x[k+2],S43,0x2AD7D2BB);b=II(b,c,d,a,x[k+9],S44,0xEB86D391);a=AddUnsigned(a,AA);b=AddUnsigned(b,BB);c=AddUnsigned(c,CC);d=AddUnsigned(d,DD);}
      var temp=WordToHex(a)+WordToHex(b)+WordToHex(c)+WordToHex(d);return temp.toLowerCase();}

    // register onclick events for 'Get MD5' button
    document.getElementById('codemd5').onclick = function() {
      var txt_string = document.getElementById('strex').value; // gets data from input text

      // encrypts data and adds it in #strmd5 element
      document.getElementById('strmd5').value = md5(txt_string);
      return false;
    }
  </script>
  <script>
    function doDate()
    {
      var str = "";

      var days = new Array("Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday");
      var months = new Array("January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December");

      var now = new Date();

      str += "Today is: " + days[now.getDay()] + ", " + now.getDate() + " " + months[now.getMonth()] + " " + now.getFullYear() + " " + now.getHours() +":" + now.getMinutes() + ":" + now.getSeconds();
      document.getElementById("todaysDate").innerHTML = str;
    }

    setInterval(doDate, 1000);
  </script>

</center>
</body>
<script>


  const iPAddress = 'http://ip.jsontest.com/';
  const headers = 'http://headers.jsontest.com/';
  const dateAndTime = 'http://date.jsontest.com ';
  const validateJson = 'http://validate.jsontest.com/?json=';
  const convertTextToMd5 = 'http://md5.jsontest.com/?text=';
  const wrongUrl = 'http://ip.jsontestttt.com/';
  const formElementJson = document.getElementById("validate-JSON-form");
  const formElementMd5 = document.getElementById("convert-to-MD5-form");
  const feedbackElementJson = document.getElementById("validation-message");
  const feedbackElementMd5 = document.getElementById("MD5-message");


  //create functions for your javascript

  const _fetch_not_ok = (url) => {
    return new Promise(((resolve, reject) => {
      resolve({
        ok: false
      })
    }))
  }

  // user ip address

  async function getUsersIPAddress(_fetch = fetch) {
    const iPResult = await _fetch(iPAddress);
    if (iPResult.ok) {
      return await iPResult.json();
    }
    return false;
  }

  const getIPFeedback = (iPResult) => {
    let iPFeedback;
    if (iPResult) {
      iPFeedback = `Your Public IP Address is ${iPResult.ip}`;
    } else {
      iPFeedback = "Error: IP Address not found";
    }
    return iPFeedback;
  }

  // Get Headers HTTPs
  async function getHeaders(_fetch = fetch) {
    const headersResult = await _fetch(headers);
    if (headersResult.ok) {
      return await headersResult.json();
    }
    return false;
  }

  const getHeadersFeedback = (headersResult) => {
    let str = "";
    let headersFeedback = "";
    if (headersResult) {
      for (header in headersResult) {
        str = `<b>${header}</b>: ${headersResult[header]}`;
        headersFeedback += str + "<br>";
      }
    } else {
      headersFeedback = "Error: could not retrieve headers";
    }
    return headersFeedback;
  }

  //calculate date and time

  async function getDateAndTime(_fetch = fetch) {
    const result = await _fetch(dateAndTime);
    if (result.ok) {
      return await result.json();
    }
    return false;
  }

  //async function to validate JSON

  async function validateJson(_fetch = fetch, text) {
    const url = `${validateJsonBaseUrl}${text}`;
    const result = await _fetch(url);
    if (result.ok) {
      return await result.json();
    }
    return false;
  }

  const generateJsonFeedback = (validationResult) => {
    if (validationResult.validate) {
      return 'The JSON entered is valid';
    } else {
      return `Your JSON result is invalid: ${validationResult.error}`;
    }
  }

  // need to convert text to MD5
  async function convertTextToMd5(_fetch = fetch, text) {
    const url = `${convertTextToMd5BaseUrl}${text}`;
    const result = await _fetch(url);
    if (result.ok) {
      return await result.json();
    }
    return false;
  }



  const renderUsersIPAddress = async () => {
    let iPResult;
    try {
      iPResult = await getUsersIPAddress();
    } catch (error) {
      console.error(error);
    }

    const iPFeedback = getIPFeedback(iPResult);
    const usersIPAddressElement = document.getElementById("user-ip-address");
    usersIPAddressElement.innerHTML = `${iPFeedback}`;
  }

  renderUsersIPAddress();


  const renderHeaders = async () => {
    const headersListElement = document.getElementById("http-headers");

    let headers;
    try {
      headers = await getHeaders();
    } catch (error) {
      console.error(error);
      const errorElement = document.getElementById("http-headers-error-message");
      errorElement.innerHTML = "error";  // should replace this with the actual error
      errorElement.hidden = false;
    }

    // }
    headersListElement.innerHTML = getHeadersFeedback(headers);
  }

  renderHeaders();

  // calculate to get date and time
  const renderDateAndTimeEverySecond = async () => {
    const dateTimeElement = document.getElementById("date-and-time");

    const callback = async () => {
      const dateAndTime = await getDateAndTime();
      const {date, time} = dateAndTime;
      dateTimeElement.innerHTML = `Date: ${date} Time: ${time}`;
    }
    setInterval(callback, 1000);
  }
  renderDateAndTimeEverySecond();


  // side function to validate JSON
  async function handleSubmitJson(event) {
    event.preventDefault();
    feedbackElementJson.hidden = true;

    const value = formElementJson[0].value;
    const validationResult = await validateJson(value);
    feedbackElementJson.hidden = false;

    const feedback = generateJsonFeedback(validationResult);
    feedbackElementJson.innerHTML = `${feedback}`;

    formElementJson.reset();
  }

  formElementJson.addEventListener("submit", handleSubmitJson);

  // text result to MD5
  async function handleSubmitMd5(event) {
    event.preventDefault();
    feedbackElementMd5.hidden = true;

    const value = formElementMd5[0].value;
    const convertToMd5Result = await convertTextToMd5(value);
    feedbackElementMd5.hidden = false;
    feedbackElementMd5.innerHTML = `The text '${value}' converts to MD5 hash: ${convertToMd5Result.md5}`;
    formElementMd5.reset();
  }

  formElementMd5.addEventListener("submit", handleSubmitMd5);


  // unit testing functions
  async function unitTestGetUsersIPAddress() {
    const _fetch_ok = url => new Promise(resolve => resolve({
        ok: true,
        json: () => new Promise(resolve => resolve({
          ip: "127.0.0.1"
        }))
      })
    )

    // Test: json is returned from getUsersIPAddress
    let response = await getUsersIPAddress(_fetch_ok)

    if (response?.ip === "127.0.0.1") {
      console.log("unitTestGetUsersIPAddress - response ok: Passed");
    } else {
      console.log("unitTestGetUsersIPAddress - response ok: Failed", response);
    }


    // Test: false is returned from getUsersIPAddress
    response = await getUsersIPAddress(_fetch_not_ok);

    if (response === false) {
      console.log("unitTestGetUsersIPAddress - response not ok: Passed");
    }
    else {
      console.log("unitTestGetUsersIPAddress - response not ok: Failed", response);
    }
  }
  // unit Test to GetUsersIPAddress();

  const unitTestGetIPFeedback = () => {
    // Test: Input is JSON
    const jSONInput = {ip: "111.11.111.1"};
    const jSONExpectedFeedback = "Your IP Address is 111.11.111.1";
    const jSONFeedback = getIPFeedback(jSONInput);

    if (jSONFeedback === jSONExpectedFeedback) {
      console.log("unitTestGetIPFeedback - input is json: Passed");
    } else {
      console.log("unitTestGetIPFeedback - input is json: Failed");
    }


    const noJsonInput = false;
    const noJsonExpectedFeedback = "Error: can't find your IP Address";
    const noJsonFeedback = getIPFeedback(noJsonInput);

    if (noJsonFeedback === noJsonExpectedFeedback) {
      console.log("unitTestGetIPFeedback - input is boolean false: Passed");
    } else {
      console.log("unitTestGetIPFeedback - input is boolean false: Failed");
    }
  }
  // unitTestGetIPFeedback();

  //headers unit testing

  async function unitTestGetHeaders() {
    const _fetch_ok = url => new Promise(resolve => resolve({
        ok: true,
        json: () => new Promise(resolve => resolve({
          Host: "headers.jsontest.com"
        }))
      })
    )

    // Test: json is returned from getHeaders
    let response = await getHeaders(_fetch_ok);
    if (response?.Host === "headers.jsontest.com") {
      console.log("unitTestGetHeaders - response ok: Passed");
    } else {
      console.log("unitTestGetHeaders - response ok: Failed", response);
    }

    // Test: false is returned from getUsersIPAddress
    response = await getHeaders(_fetch_not_ok);
    if (response === false) {
      console.log("unitTestGetHeaders - response not ok: Passed")
    }    else {
      console.log("unitTestGetHeaders - response not ok: Failed", response);
    }
  }
  // unitTestGetHeaders();

  async function unitTestGetHeadersFeedback() {

  }

  //DATE AND TIME unit tests

  async function unitTestGetDateAndTime() {
    const _fetch_ok = url => new Promise(resolve => resolve({
        ok: true,
        json: () => new Promise(resolve => resolve({
          time: "03:53:25 AM",
          milliseconds_since_epoch: 1362196405309,
          date: "03-02-2013"
        }))
      })
    )

    // Test: json is returned from getDateAndTime
    let response = await getDateAndTime(_fetch_ok);
    if (response?.date === "03-02-2013") {
      console.log("unitTestGetDateAndTime - response ok: Passed");
    } else {
      console.log("unitTestGetDateAndTime - response ok: Failed", response);
    }

    // Test: false is returned from getUsersIPAddress
    response = await getDateAndTime(_fetch_not_ok);
    if (response === false) {
      console.log("unitTestGetDateAndTime - response not ok: Passed")
    }    else {
      console.log("unitTestGetDateAndTime - response not ok: Failed", response);
    }
  }
  // unitTestGetDateAndTime();

//JSOn Element Unit Test
  async function unitTestValidateJson() {
    const _fetch_ok_valid_json = url => new Promise(resolve => resolve({
        ok: true,
        json: () => new Promise(resolve => resolve({
          object_or_array: "object",
          empty: false,
          parse_time_nanoseconds: 19608,
          validate: true,
          size: 1
        }))
      })
    )
    // Test: json input is valid and json is returned from validateJson
    let response = await validateJson(_fetch_ok_valid_json);
    if (response?.validate) {
      console.log("unitTestValidateJson - valid JSON, response ok: Passed");
    } else {
      console.log("unitTestValidateJson - valid JSON, response ok: Failed", response);
    }

    const _fetch_ok_invalid_json = url => new Promise(resolve => resolve({
        ok: true,
        json: () => new Promise(resolve => resolve({
          error: "Expected a ',' or '}' at 15 [character 16 line 1]",
          object_or_array: "object",
          error_info: "This error came from the org.json reference parser.",
          validate: false
        }))
      })
    )

    // Test: json input is invalid and json is returned from validateJson
    response = await validateJson(_fetch_ok_invalid_json);
    if (!response?.validate) {
      console.log("unitTestValidateJson - invalid JSON, response ok: Passed");
    } else {
      console.log("unitTestValidateJson - invalid JSON, response ok: Failed", response);
    }

    // // Test: false is returned from getUsersIPAddress
    response = await validateJson(_fetch_not_ok);
    if (response === false) {
      console.log("unitTestValidateJson - response not ok: Passed")
    }    else {
      console.log("unitTestValidateJson - response not ok: Failed", response);
    }
  }
  // unitTestValidateJson();
 // Testing MD5 Unit Test
  async function unitTestConvertTextToMd5() {
    const _fetch_ok = url => new Promise(resolve => resolve({
        ok: true,
        json: () => new Promise(resolve => resolve({
          md5: "fa4c6baa0812e5b5c80ed8885e55a8a6",
          original: "example_text"
        }))
      })
    )

    // Test: json is returned from convertTextToMd5
    let response = await convertTextToMd5(_fetch_ok);
    if (response?.md5 === "fa4c6baa0812e5b5c80ed8885e55a8a6") {
      console.log("unitTestConvertTextToMd5 - response ok: Passed");
    } else {
      console.log("unitTestConvertTextToMd5 - response ok: Failed", response);
    }

    // Test: false is returned from convertTextToMd5
    response = await convertTextToMd5(_fetch_not_ok);
    if (response === false) {
      console.log("unitTestConvertTextToMd5 - response not ok: Passed")
    }    else {
      console.log("unitTestConvertTextToMd5 - response not ok: Failed", response);
    }
  }
  unitTestConvertTextToMd5();
</script>
</html>
